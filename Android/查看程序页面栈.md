``` sh
#!/bin/sh

function printCurrent {
  # Android 11+
  adb shell dumpsys window | grep "mFocusedApp"
  adb shell dumpsys window windows | grep mObscuringWindow

  # Android 10-
  # adb shell dumpsys window windows | grep "mFocusedApp"
  # adb shell dumpsys window windows | grep "mCurrentFocus"
}

function printStack {
  adb shell dumpsys activity $name \
    | grep \
    -e "pid=" \
    -e "Local Activity" \
    -e "Local FragmentActivity" \
    -e " FragmentManager{" \
    -e "Active Fragments" \
    -e "Added Fragments" \
    -e "  #"
}

function printAll {
  echo =============================
  echo
  printCurrent
  echo
  printStack
}

function empty {
  printf "\33c\e[3J"
}

function printDiff {
  declare isSilent=$1
  declare mode
  case $isSilent in
    0) mode="--left-column";;
    1) mode="-s --suppress-common-lines";;
  esac
  diff -y -W233 $mode TempLastStack.log TempCurrentStack.log
}

function compare {
  mv TempCurrentStack.log TempLastStack.log
  printAll > TempCurrentStack.log
  printDiff 0
  echo
  echo "✳️  ✳️  ✳️  ✳️   差量 ✳️  ✳️  ✳️  ✳️   "
  printDiff 1
}

cd ${0%/*}
mkdir DumpsysLogs
cd DumpsysLogs

empty
echo
read -p "Enter package name or process name: " name
echo

rm TempLastStack.log
printAll > TempCurrentStack.log
cat TempCurrentStack.log

while echo && read -n1 -r -p "[q 退出] [e 清屏] [c 对比] [其他任意键 输出常规栈] ➡️  " && [[ $REPLY != q ]] ; do
  echo
  echo
  case $REPLY in
    e) empty;;
    c) compare;;
    *) printAll;;
  esac
done

echo
```
